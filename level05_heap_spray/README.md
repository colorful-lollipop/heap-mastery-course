# Level 5: Heap Spraying

**éš¾åº¦**: â­â­â­â­ (é«˜çº§)
**å­¦ä¹ ç›®æ ‡**: æŒæ¡å †å–·å°„æŠ€æœ¯ï¼Œæé«˜åˆ©ç”¨å¯é æ€§

## ğŸ¯ ç›®æ ‡

ä½¿ç”¨å †å–·æŠ€æœ¯åœ¨å†…å­˜ä¸­åˆ›å»ºç‰¹å®šæ¨¡å¼ï¼Œæé«˜ UAF åˆ©ç”¨å¯é æ€§

## ğŸ’¡ æ€è·¯

### å †å–·åŸç†

å¤§é‡åˆ†é…ç›¸åŒå¤§å°çš„ chunkï¼Œå¡«å……å†…å­˜ä¸­çš„"æ´"æˆ–ç‰¹å®šä½ç½®ï¼š

```
Before spray:
  [free] [alloc] [free] [alloc] [free] ...

After spraying 100 chunks:
  [spray] [spray] [spray] [spray] [spray] ...
```

### åˆ©ç”¨æ­¥éª¤

1. åˆ†é…å¤§é‡ç›¸åŒå¤§å°çš„ chunksï¼ˆå †å–·ï¼‰
2. åˆ›å»ºç‰¹å®šæ¨¡å¼ï¼ˆå¦‚ 0x53505241592121 = "!SPRAY!"ï¼‰
3. é‡Šæ”¾éƒ¨åˆ† chunk åˆ¶é€ ç©ºæ´
4. åˆ©ç”¨ UAF æ§åˆ¶è¢«å–·æ´’çš„åŒºåŸŸ

## æŠ€æœ¯åŸç†

### ä¸ºä»€ä¹ˆéœ€è¦å †å–·ï¼Ÿ

1. **æé«˜å¯é æ€§**ï¼šä¸æ˜¯æ¯æ¬¡åˆ†é…éƒ½æˆåŠŸ
2. **å¸ƒå±€æ§åˆ¶**ï¼šç²¾ç¡®æ§åˆ¶å†…å­˜ä½ç½®
3. **å¯¹æŠ— ASLR**ï¼šå¢åŠ å‘½ä¸­ç‡

### å †å–·æ¨¡å¼

```python
# Python ç¤ºä¾‹
payload = p64(0x53505241592121)  # ç›®æ ‡æ¨¡å¼

for i in range(100):
    alloc(32, payload)  # å–·å°„ 100 ä¸ª chunk
```

## åº”ç”¨åœºæ™¯

- **æµè§ˆå™¨æ¼æ´**: JIT å–·å°„ã€å †å–·å°„
- **UAF åˆ©ç”¨**: æé«˜å¯¹è±¡é‡ç”¨æˆåŠŸç‡
- **å †é£æ°´**: é…åˆå¤æ‚åˆ©ç”¨é“¾

## å‚è€ƒèµ„æº

- [Browser Heap Spraying](https://www.exploit-db.com/docs/28479)
- [Modern Heap Exploitation](https://samsclass.info/127/exploiting/heap-spray.htm)

ç»§ç»­ **[Level 6: Heap Feng Shui](../level06_feng_shui/)**ï¼
