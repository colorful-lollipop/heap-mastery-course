#ifndef EXPLOIT_UTILS_H
#define EXPLOIT_UTILS_H

#include <stdint.h>
#include <stddef.h>

// Address manipulation
#define ALIGN_UP(x, a)   (((x) + ((a) - 1)) & ~((a) - 1))
#define ALIGN_DOWN(x, a) ((x) & ~((a) - 1))

// Chunk size calculations (glibc malloc specific)
#define CHUNK_SIZE(sz)   ((sz) + 0x10)  // Size with header
#define PREV_INUSE       0x1            // Previous size in use bit
#define IS_MMAPPED       0x2            // Is mmap'd chunk
#define NON_MAIN_ARENA   0x4            // Non-main arena

// Useful constants
#define SIZE_T_SIZE      (sizeof(size_t))
#define SIZE_SZ          (sizeof(size_t))
#define MALLOC_ALIGN     (2 * SIZE_SZ)
#define MALLOC_ALIGN_MASK (MALLOC_ALIGN - 1)

// Helper functions
size_t get_chunk_size_field(void *ptr);
void set_chunk_size_field(void *ptr, size_t size);
void *get_chunk_data_ptr(void *chunk);
size_t get_usable_size(void *ptr);

// Address utilities
void *align_address(void *addr, size_t alignment);
int is_aligned(void *addr, size_t alignment);

// Primitive exploit functions
void arbitrary_write(void *addr, uint64_t value);
uint64_t arbitrary_read(void *addr);

// Shellcode execution (for educational purposes)
void execute_shellcode(void *shellcode);
void *get_shellcode_addr(void);

#endif // EXPLOIT_UTILS_H
